<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <head>
    <style>
      #menu {
        margin: 1px 0px;
        font-size: 20px;
      }
      #content {
        margin: 50px 0px;
        font-size: 50px;
        text-align: center;
      }
      [v-cloak] {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="menu" v-cloak>
        <span>間隔 {{sec}} 秒</span><input type="range" min="0" max="20" v-model="sec">
        |
        <span>読む速さ {{speed}} %</span><input type="range" min="10" max="250" v-model="speed">
        |
      <div>
      <hr/>
      <div v-cloak id="content">
        <h1 v-html="currentContent"></h1>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      //
      const KUKU = {"いち":{"いんいちが":"1 × 1"},"に":{"いんにが":"1 × 2","にいちが":"2 × 1"},"さん":{"いんさんが":"1 × 3","さんいちが":"3 × 1"},"し":{"いんしが":"1 × 4","ににんが":"2 × 2","しいちが":"4 × 1"},"ご":{"いんごが":"1 × 5","ごいちが":"5 × 1"},"ろく":{"いんろくが":"1 × 6","にさんが":"2 × 3","さんにが":"3 × 2","ろくいちが":"6 × 1"},"しち":{"いんしちが":"1 × 7","しちいちが":"7 × 1"},"はち":{"いんはちが":"1 × 8","にしが":"2 × 4","しにが":"4 × 2","はちいちが":"8 × 1"},"く":{"いんくが":"1 × 9","さざんが":"3 × 3","くいちが":"9 × 1"},"じゅう":{"にご":"2 × 5","ごに":"5 × 2"},"じゅうに":{"にろく":"2 × 6","さんし":"3 × 4","しさん":"4 × 3","ろくに":"6 × 2"},"じゅうし":{"にしち":"2 × 7","しちに":"7 × 2"},"じゅうろく":{"にはち":"2 × 8","しし":"4 × 4","はちに":"8 × 2"},"じゅうはち":{"にく":"2 × 9","さぶろく":"3 × 6","ろくさん":"6 × 3","くに":"9 × 2"},"じゅうご":{"さんご":"3 × 5","ごさん":"5 × 3"},"にじゅういち":{"さんしち":"3 × 7","しちさん":"7 × 3"},"にじゅうし":{"さんぱ":"3 × 8","しろく":"4 × 6","ろくし":"6 × 4","はっさん":"8 × 3"},"にじゅうしち":{"さんく":"3 × 9","くさん":"9 × 3"},"にじゅう":{"しご":"4 × 5","ごし":"5 × 4"},"にじゅうはち":{"ししち":"4 × 7","しちし":"7 × 4"},"さんじゅうに":{"しは":"4 × 8","はちし":"8 × 4"},"さんじゅうろく":{"しく":"4 × 9","ろくろく":"6 × 6","くし":"9 × 4"},"にじゅうご":{"ごご":"5 × 5"},"さんじゅう":{"ごろく":"5 × 6","ろくご":"6 × 5"},"さんじゅうご":{"ごしち":"5 × 7","しちご":"7 × 5"},"しじゅう":{"ごは":"5 × 8","はちご":"8 × 5"},"しじゅうご":{"ごっく":"5 × 9","くご":"9 × 5"},"しじゅうに":{"ろくしち":"6 × 7","しちろく":"7 × 6"},"しじゅうはち":{"ろくは":"6 × 8","はちろく":"8 × 6"},"ごじゅうし":{"ろっく":"6 × 9","くろく":"9 × 6"},"しじゅうく":{"しちしち":"7 × 7"},"ごじゅうろく":{"しちは":"7 × 8","はちしち":"8 × 7"},"ろくじゅうさん":{"しちく":"7 × 9","くしち":"9 × 7"},"ろくじゅうし":{"はっぱ":"8 × 8"},"しちじゅうに":{"はっく":"8 × 9","くは":"9 × 8"},"はちじゅういち":{"くく":"9 × 9"}}
      
      new Vue({
        el: '#app',
        //
        data: {
          currentContent: '',
          indexes: [],
          sec: 10,
          speed: 100,
        },
        //
        computed: {
          done () {
            return (this.indexes.length < 1)
          },
        },
        //
        created () {
          const idxs = [...Array(Object.keys(KUKU).length).keys()]
          
          for(let i = idxs.length - 1; i > 0; i--){
            let r = Math.floor(Math.random() * (i + 1))
            let tmp = idxs[i]
            idxs[i] = idxs[r]
            idxs[r] = tmp
          }
          
          this.indexes = idxs;
        },
        //
        mounted () {
          this.init()
        },
        //
        methods: {
          //
          nextCard (event) {
            if (this.done) {
              this.currentContent = '終わり'
              return
            }
          
            const index = this.indexes[0]
            
            const ans = Object.keys(KUKU)[index]
            const queMap = KUKU[ans]
            // TODO read! random
            const queRead = Object.keys(queMap)[0]
            
            this.currentContent = queMap[queRead]
            try {
              const utterance = new SpeechSynthesisUtterance(queRead + "、 、 、" + ans)
              utterance.rate = (this.speed / 100.0)

              speechSynthesis.speak(utterance)
            } catch(e) {
              console.log(e)
            }
            this.indexes.splice(0, 1)
            
            setTimeout(
              this.nextCard,
              1000 * this.sec
            )
          },
          //
          init () {
            // first time
            setTimeout(
              this.nextCard,
              1000
            )
          },
        },
      })
    </script>
  </body>
</html>