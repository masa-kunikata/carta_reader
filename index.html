<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roudokuka/docs/roudokuka.min.js"></script>
<script>
$(function(){
  
  var data = [];
  function loadData() {
    var s = location.search;
    
    var dataType = 'cities'
    if (s != '') {
      var m = s.match(/\?data=(.+)/)
      if (m) {
        dataType = m[1];
      }
    }
    var jsonUrl = "https://raw.githubusercontent.com/masa-kunikata/carta_reader/master/data/" + dataType + ".json"
    
    $.getJSON(jsonUrl)
      .done(function(resp,textStatus,jqXHR ) {
        data = resp;
      })
      .fail(function(jqXHR, textStatus, errorThrown ) {
        console.log(errorThrown);
      });
  }
  loadData();
  
  function getRandomInt(max) {
    return Math.floor(Math.random() * Math.floor(max));
  }
  
  function nextTarget() {
    if (data.length < 1) {
      return null;
    }
    return getRandomInt(data.length);
  }

  $(document).on('click keydown tap', function(){
    var index = nextTarget();
    
    if (index == null) {
      $('#disp').text('終わり');
      $('#reload').css({display: 'inline'})
      return;
    }
    var text = data[index];
    $('#disp').text(text);
    
    try {
      var r = new Roudokuka([text]);
      r.start();
    } catch(e) {
      console.log(e);
    }
    data.splice(index, 1);
  });
  
  $('#disp').text('クリック / なんかキー押す');
  
  $('#reload').on('click', function(){
    location.reload();
  });
  
});
</script>
<style>
#disp {
  padding: 50px 0px;
  font-size: 150px;
  text-align: center;
}
</style>
</head>
<body>
<button style="display:none;" id="reload">もう一回</button>
<h1 id="disp"></h1>
</body>
</html>