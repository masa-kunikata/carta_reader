require 'json'


task default: :text_to_json 


DATA_FILE = 'hyakuninisshu_data.txt'

OUT_JSON = '../hyakuninisshu.json'

#property	上の句	上の句カナ	下の句	下の句カナ	作者
LINE_REGEX = /
  (?<no>[0-9]+?)\t
  (?<kami>.+?)\t
  (?<kamikana>.+?)\t
  (?<shimo>.+?)\t
  (?<shimokana>.+?)\t
  (?<author>.+?)\Z
/x

desc "data text to json"
task :text_to_json do
  
  content = File.read(DATA_FILE, encoding: Encoding::UTF_8)

  json_data = []
  
  content.each_line do |line|
  
    next if line =~ /^#/ # comment line
    
    m = LINE_REGEX.match(line)
    
    
    json_data << "#{m['kamikana']}　　　#{m['shimokana']}"
  end
  
  
  File.write(OUT_JSON, json_data.to_json, encoding: Encoding::UTF_8)
  
end

def category_out(prefixes, out_path)
  content = File.read(DATA_FILE, encoding: Encoding::UTF_8)

  json_data = []
  
  content.each_line do |line|
  
    next if line =~ /^#/ # comment line
    
    m = LINE_REGEX.match(line)
    
    next unless prefixes.include?(m['kamikana'])
    
    json_data << {
      text: "#{m['kami']}　　　#{m['shimo']}",
      read: "#{m['kamikana']}、、、#{m['shimokana']}",
    }
  end
  
  File.write(out_path, json_data.to_json, encoding: Encoding::UTF_8)
end



BLUE_PREFIXES = [
  "アシビキノ　ヤマドリノオノ　シダリオノ",
  "アリアケノ　ツレナクミエシ　ワカレヨリ",
  "アラシフク　ミムロノヤマノ　モミジバワ",
  "オクヤマニ　モミジフミワケ　ナクシカノ",
  "アサボラケ　アリアケノツキト　ミルマデニ",
  "サビシサニ　ヤドオタチイデテ　ナガムレバ",
  "カササギノ　ワタセルハシニ　オクシモノ",
  "キミガタメ　オシカラザリシ　イノチサエ",
  "ウカリケル　ヒトオハツセノ　ヤマオロシヨ",
  "アマツカゼ　クモノカヨイジ　フキトジヨ",
  "メグリアイテ　ミシヤソレトモ　ワカヌマニ",
  "ワタノハラ　コギイデテミレバ　ヒサカタノ",
  "ミチノクノ　シノブモジズリ　タレユエニ",
  "イニシエノ　ナラノミヤコノ　ヤエザクラ",
  "キリギリス　ナクヤシモヨノ　サムシロニ",
  "コノタビワ　ヌサモトリアエズ　タムケヤマ",
  "ヨオコメテ　トリノソラネワ　ハカルトモ",
  "モモシキヤ　フルキノキバノ　シノブニモ",
  "チギリオキシ　サセモガツユオ　イノチニテ",
  "オモイワビ　サテモイノチワ　アルモノオ",
]

RED_PREFIXES = %w<
ナゲケトテ　ツキヤワモノオ　オモワスル
コヌヒトオ　マツオノウラノ　ユーナギニ
モロトモニ　アワレトオモエ　ヤマザクラ
オトニキク　タカシノハマノ　アダナミワ
タカサゴノ　オノエノサクラ　サキニケリ
ナガカラン　ココロモシラズ　クロカミノ
カクトダニ　エヤワイブキノ　サシモグサ
アリマヤマ　イナノササハラ　カゼフケバ
ウラミワビ　ホサヌソデダニ　アルモノオ
タレオカモ　シルヒトニセン　タカサゴノ

シノブレド　イロニイデニケリ　ワガコイワ
カゼオイタミ　イワウツナミノ　オノレノミ
タチワカレ　イナバノヤマノ　ミネニオール
フクカラニ　アキノクサキノ　シオルレバ
ヤマザトワ　フユゾサビシサ　マサリケル
アキノタノ　カリオノイオノ　トマオアラミ
タゴノウラニ　ウチイデテミレバ　シロタエノ
ツクバネノ　ミネヨリオツル　ミナノガワ
ヨノナカヨ　ミチコソナケレ　オモイイル
ナガラエバ　マタコノゴロヤ　シノバレン
>

YELLOW_PREFIXES = %w<
ハルスギテ　ナツキニケラシ　シロタエノ
アマノハラ　フリサケミレバ　カスガナル
コレヤコノ　ユクモカエルモ　ワカレテワ
スミノエノ　キシニヨルナミ　ヨルサエヤ
ヤマガワニ　カゼノカケタル　シガラミワ
ヒサカタノ　ヒカリノドケキ　ハルノヒニ
シラツユニ　カゼノフキシク　アキノノワ
アサジウノ　オノノシノハラ　シノブレド
ユラノトオ　ワタルフナビト　カジオタエ
ヤエムグラ　シゲレルヤドノ　サビシキニ

タキノオトワ　タエテヒサシク　ナリヌレド
オーエヤマ　イクノノミチノ　トーケレバ
アワジシマ　カヨーチドリノ　ナクコエニ
アキカゼニ　タナビククモノ　タエマヨリ
ホトトギス　ナキツルカタオ　ナガムレバ
ムラサメノ　ツユモマダヒヌ　マキノハニ
ミヨシノノ　ヤマノアキカゼ　サヨフケテ
ハナサソー　アラシノニワノ　ユキナラデ
ヨモスガラ　モノオモーコロワ　アケヤラデ
タマノオヨ　タエナバタエネ　ナガラエバ
>

GREEN_PREFIXES = %w<
ワガイオワ　ミヤコノタツミ　シカゾスム
ハナノイロワ　ウツリニケリナ　イタズラニ
ワタノハラ　ヤソシマカケテ　コギイデヌト
キミガタメ　ハルノノニイデテ　ワカナツム
チハヤブル　カミヨモキカズ　タツタガワ
ワビヌレバ　イマハタオナジ　ナニワナル
ツキミレバ　チジニモノコソ　カナシケレ
オグラヤマ　ミネノモミジバ　ココロアラバ
ココロアテニ　オラバヤオラン　ハツシモノ
ヒトワイサ　ココロモシラズ　フルサトワ

ナツノヨワ　マダヨイナガラ　アケヌルオ
ワスラルル　ミオバオモワズ　チカイテシ
コイスチョー　ワガナワマダキ　タチニケリ
チギリキナ　カタミニソデオ　シボリツツ
ワスレジノ　ユクスエマデワ　カタケレバ
ヤスラワデ　ネナマシモノオ　サヨフケテ
ココロニモ　アラデウキヨニ　ナガラエバ
ユーサレバ　カドタノイナバ　オトズレテ
ワガソデワ　シオヒニミエヌ　オキノイシノ
ヨノナカワ　ツネニモガモナ　ナギサコグ
>

ORANGE_PREFIXES = %w<
アケヌレバ　クルルモノトワ　シリナガラ
アサボラケ　ウジノカワギリ　タエダエニ
アワレトモ　ユーベキヒトワ　オモオエデ
アイミテノ　ノチノココロニ　クラブレバ
オーコトノ　タエテシナクワ　ナカナカニ
アラザラン　コノヨノホカノ　オモイデニ
イマコント　イイシバカリニ　ナガツキノ
イマワタダ　オモイタエナン　トバカリオ
セオハヤミ　イワニセカルル　タキガワノ
ナゲキツツ　ヒトリヌルヨノ　アクルマワ

ナニシオワバ　オーサカヤマノ　サネカズラ
ナニワエノ　アシノカリネノ　ヒトヨユエ
ナニワガタ　ミジカキアシノ　フシノマモ
ハルノヨノ　ユメバカリナル　タマクラニ
ヒトモオシ　ヒトモウラメシ　アジキナク
ミカキモリ　エジノタクヒノ　ヨルワモエ
ミカノハラ　ワキテナガルル　イズミガワ
ミセバヤナ　オジマノアマノ　ソデダニモ
オオケナク　ウキヨノタミニ　オオーカナ
カゼソヨグ　ナラノオガワノ　ユーグレワ
>




%w<blue red yellow green orange>.each.with_index do |color, index|

  const_sym = :"#{color.upcase}_PREFIXES"
  
  target_prefixes = self.class.const_get(const_sym)

  desc "#{color} data text to json"
  task :"#{color}_category" do
    category_out(target_prefixes, "../hya_#{'%02d' % (index + 1)}_#{color}.json")
  end

end



