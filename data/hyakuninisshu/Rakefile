require 'json'


task default: :text_to_json 


DATA_FILE = 'hyakuninisshu_data.txt'

OUT_JSON = '../hyakuninisshu.json'

#property	上の句	上の句カナ	下の句	下の句カナ	作者
LINE_REGEX = /
  (?<no>[0-9]+?)\t
  (?<kami>.+?)\t
  (?<kamikana>.+?)\t
  (?<shimo>.+?)\t
  (?<shimokana>.+?)\t
  (?<author>.+?)\Z
/x

desc "data text to json"
task :text_to_json do
  
  content = File.read(DATA_FILE, encoding: Encoding::UTF_8)

  json_data = []
  
  content.each_line do |line|
  
    next if line =~ /^#/ # comment line
    
    m = LINE_REGEX.match(line)
    
    
    json_data << "#{m['kamikana']}　　　#{m['shimokana']}"
  end
  
  
  File.write(OUT_JSON, json_data.to_json, encoding: Encoding::UTF_8)
  
end

def category_out(prefixes, out_path)
  content = File.read(DATA_FILE, encoding: Encoding::UTF_8)

  json_data = []
  
  content.each_line do |line|
  
    next if line =~ /^#/ # comment line
    
    m = LINE_REGEX.match(line)
    
    next unless prefixes.include?(m['kamikana'])
    
    json_data << {
      text: "#{m['kami']}　　　#{m['shimo']}",
      read: "#{m['kamikana']}、、、#{m['shimokana']}",
    }
  end
  
  File.write(out_path, json_data.to_json, encoding: Encoding::UTF_8)
end



BLUE_PREFIXES = [
  "アシビキノ　ヤマドリノオノ　シダリオノ",
  "アリアケノ　ツレナクミエシ　ワカレヨリ",
  "アラシフク　ミムロノヤマノ　モミジバワ",
  "オクヤマニ　モミジフミワケ　ナクシカノ",
  "アサボラケ　アリアケノツキト　ミルマデニ",
  "サビシサニ　ヤドオタチイデテ　ナガムレバ",
  "カササギノ　ワタセルハシニ　オクシモノ",
  "キミガタメ　オシカラザリシ　イノチサエ",
  "ウカリケル　ヒトオハツセノ　ヤマオロシヨ",
  "アマツカゼ　クモノカヨイジ　フキトジヨ",
  "メグリアイテ　ミシヤソレトモ　ワカヌマニ",
  "ワタノハラ　コギイデテミレバ　ヒサカタノ",
  "ミチノクノ　シノブモジズリ　タレユエニ",
  "イニシエノ　ナラノミヤコノ　ヤエザクラ",
  "キリギリス　ナクヤシモヨノ　サムシロニ",
  "コノタビワ　ヌサモトリアエズ　タムケヤマ",
  "ヨオコメテ　トリノソラネワ　ハカルトモ",
  "モモシキヤ　フルキノキバノ　シノブニモ",
  "チギリオキシ　サセモガツユオ　イノチニテ",
  "オモイワビ　サテモイノチワ　アルモノオ",
]


desc "blue data text to json"
task :blue_category do
  category_out(BLUE_PREFIXES, "../hya_01_blue.json")
end


RED_PREFIXES = %w<
ナゲケトテ　ツキヤハモノヲ　オモワスル
コヌヒトヲ　マツホノウラノ　ユウナギニ
モロトモニ　アワレトオモエ　ヤマザクラ
オトニキク　タカシノハマノ　アダナミワ
タカサゴノ　オノエノサクラ　サキニキリ
ナガカラム　ココロモシラズ　クロカミノ
カクトダニ　エヤワイブキノ　サシモグサ
アリマヤマ　イナノササハラ　カゼフケバ
ウラミワビ　ホサヌソデダニ　アルモノヲ
タレヲカモ　シルヒトニセム　タカサゴノ

シノブレド　イロニイデニケリ　ワガコイワ
カゼヲイタミ　イワウツナミノ　オノレノミ
タチワカレ　イナバノヤマノ　ミネニオウル
フクカラニ　アキノクサキノ　シオルレバ
ヤマザトハ　フユゾサビシサ　マサリケル
アキノタノ　カリホノイオノ　トマヲアラミ
タゴノウラニ　ウチイデテミレバ　シロタエノ
ツクバネノ　ミネヨリオツル　ミナノガワ
ヨノナカヨ　ミチコソナケレ　オモイイル
ナガラエバ　マタコノゴロヤ　シノバレン
>


YELLOW_PREFIXES = %w<
ハルスギテ　ナツキニケラシ　シロタエノ
アマノハラ　フリサケミレバ　カスガナル
コレヤコノ　ユクモカエルモ　ワカレテハ
スミノエノ　キシニヨルナミ　ヨルサエヤ
ヤマガワニ　カゼノカケタル　シガラミワ
ヒサカタノ　ヒカリノドケキ　ハルノヒニ
シラツユニ　カゼノフキシク　アキノノハ
アサジウノ　オノノシノハラ　シノブレド
ユラノトヲ　ワタルフナビト　カジヲタエ
ヤエムグラ　シゲレルヤドノ　サビシキニ

タキノオトワ　タエテヒサシク　ナリヌレド
オオエヤマ　イクノノミチノ　トオケレバ
アワジシマ　カヨウチドリノ　ナクコエニ
アキカゼニ　タナビククモノ　タエマヨリ
ホトトギス　ナキツルカタヲ　ナガムレバ
ムラサメノ　ツユモマダヒヌ　マキノハニ
ミヨシノノ　ヤマノアキカゼ　サヨフケテ
ハナサソウ　アラシノニワノ　ユキナラデ
ヨモスガラ　モノオモウコロワ　アケヤラデ
タマノヲヨ　タエナバタエネ　ナガラエバ
>


GREEN_PREFIXES = %w<
ワガイオワ　ミヤコノタツミ　シガゾスム
ハナノイロハ　ウツリニケリナ　イタズラニ
ワタノハラ　ヤソシマカケテ　コギイデヌト
キミガタメ　ハルノノニイデテ　ワカナツム
チハヤフル　カミヨモキカズ　タツタガワ
ワビヌレバ　イマワタオナジ　ナニワナル
ツキミレバ　チジニモノコト　カナシケレ
オグラヤマ　ミネノモミジバ　ココロアラバ
ココロアテニ　オラバヤオラン　ハツシモノ
ヒトハイサ　ココロモシラズ　フルサトワ

ナツノヨワ　マダヨイナガラ　アケヌルヲ
ワスラルル　ミヲバオモワズ　チカイテシ
コイスチョー　ワガナワマダキ　タチニケリ
チギリキナ　カタミニソデヲ　シボリツツ
ワスレジノ　ユクスエマデワ　カタケレバ
ヤスラワデ　ネナマシモノヲ　サヨフケテ
ココロニモ　アラデウキヨニ　ナガラエバ
ユウサレバ　カドタノイナバ　オトズレテ
ワガソデワ　シオイニミエヌ　オキノイシノ
ヨノナカワ　ツネニモガモナ　ナギサコグ
>

ORANGE_PREFIXES = %w<
アケヌレバ　クルルモノトハ　シリナガラ
アサボラケ　ウジノカワギリ　タエダエニ
アワレトモ　イウベキヒトハ　オモオエデ
アイミテノ　ノチノココロニ　クラブレバ
オーコトノ　タエテシナクバ　ナカナカニ
アラザラン　コノヨノホカノ　オモイデニ
イマコント　イイシバカリニ　ナガツキノ
イマワタダ　オモイタエン　トバカリヲ
セヲハヤミ　イワニセカルル　タキガワノ
ナゲキツツ　ヒトリヌルヨノ　アクルマワ

ナニシオアバ　オーサカヤマノ　サネカズラ
ナニワエノ　アシノカリネノ　ヒトユユエ
ナニワガタ　ミジカキアシノ　フシノマモ
ハルノヨノ　ユメバカリナル　タマクラニ
ヒトモオシ　ヒトモウラメシ　アジキナク
ミカキモリ　エジノタクヒノ　ヨルワモエ
ミカノハラ　ワキテナガルル　イズミガワ
ミセバヤナ　オジマノアマノ　ソデダニモ
オーケナク　ウキヨノタミニ　オーウカナ
カゼソヨグ　ナラノミヤコノ　ユウグレワ
>